<!DOCTYPE html>
<html lang="ja"><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta property="og:title" content="libGDX入門 その02 カメラとビューポート" />
<meta property="og:description" content="はじめに libGDX を勉強するついでに解説記事を書く シリーズ 2回目です。
前回 は、プロジェクトを作って、以下のことを学びました。
 画像の表示 キーボードによる操作 BGMの再生 効果音の再生  今回は次のことを学びます。
 物理画面に依存しない画面表示 タッチ処理  物理画面に依存しない画面表示  物理画面とは何でしょうか？ここでは次のように定義します。 スマホやタブレット画面解像度 デスクトップのウィンドウサイズ Androidには様々な画面サイズがありますし、 iPhoneもモデルチェンジ毎に画面サイズが変化しています。 これら様々な画面サイズのことを考慮しないと、 意図した通りの画面が表示できません。  ゲームを作るときの基本として、物理画面でプログラムしないというのがあります。 物理的なディスプレイのサイズに依存した座標管理をすると、 移植性が下がり仕様変更に弱くなったり、 端末毎の画面サイズの違いを吸収できないプログラムになってしまいます。
例えば横スクロールアクションを作ったときに、 Aさんの画面は小さいから敵の動きがところ狭しとなるところが、 Bさんの端末だと画面が大きいからフィールドが遠くまで見わたせて楽々プレイできる、 なんてことが発生します。端末によって難易度が変わってくるのです。
https://zarudama.github.io/img/libgdx-beginner/2/screen2.png
実は既にこの問題は、私の手元で発生しています。 下記は、Nexus7(2013)で表示したサンプルの画面です。
http://zarudama.github.io/img/libgdx-beginner/2/004.png
/img/libgdx-beginner/2/003.png
Nexus7版は、PCの画面と全然違いますね。キャラクターや文字が非常に小さくなってます。 これはPC版が640x480の解像度なのに対して、Nexus7版は1920x1200の解像度で表示しているからです。 この状態でゲームを作ってしまったら全然別ものになってしまいますよね。 ちなみにMac持ってないのでiOS系ではどうなるかわかりません。
というわけで、どの端末でも公平に画面表示できるようにひと工夫必要になってきます (こういう処理は、ゲームづくりの序盤でやっておかないと、あとから変更するのは大変なので さっさと済ませておきたいことのひとつですね)。
カメラとビューポート ではどうやってこの問題を解決するか。それにはカメラとビューポートを使用します。
カメラとは、ゲームの世界を現実世界のディスプレイに届けるためのオブジェクトです。
ビューポートとは、カメラの捉えたゲームの世界を、ディスプレイのどこに表示するかを 決める枠(矩形領域)のことです。
https://zarudama.github.io/img/libgdx-beginner/2/screen3.png
ビューポートは、ディスプレイサイズと一致しているわけではないことに注意してください。 ゲームのサンプルなどだと一致していることが多いですが、 今回のように様々なディスプレイサイズに対応させる場合は、 一致しなくなることの方が多くなるはずです。また、他の使い方としては、 カメラを2つ用意して一方はゲーム画面、 一方は小さな枠で別のシーンを表示するなんてこともできるかもしれません(やったことないですが)。
 カメラを使うことにより、カメラとして定義した論理空間でゲームを制御できます。 この空間でやりとりすれば、あとはlibGDXがよろしく画面に表示してくれるわけです。 カメラでできることを列挙してみます。 物理的な画面サイズを気にせず、自分の定義した画面サイズでゲームを構築できる ズームイン、ズームアウト、画面を回転させたり、揺らしたりなど、画面全体にかかるエフェクトが簡単にできる カメラを動かすことで、スクロール処理が簡単に実装できる カメラを導入することでこのような自由が手に入るわけですが、 その代償として操作が複雑になってしまうのも事実です。 コーディング中は、今自分がどこの座標系で何を操作しているかを常に意識する必要があります。 ちょっと大袈裟ですが、慣れれば大したことありません。またこの考えはそのまま3Dプログラミングにも繋がります。   座標系には、以下の種類があります。 ワールド座標系。ゲームオブジェクトを置く論理空間。画面サイズは気にしなくて良い。 カメラ座標系。ワールドのゲームオブジェクトをカメラの枠での座標系で測りなおした座標系。真ん中が原点となる。 ビューポート座標系。左下を原点とした座標系。 スクリーン座標系。Android左上を原点とした最終的な座標系。タッチ座標などはOSからこの座標系の値が得られる。  ビューポート座標系とスクリーン座標系は他では別の呼びかたかもしれません。 座標系を意識する例を示します。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zarudama.github.io/posts/libgdx-beginner2/" />
<meta property="article:published_time" content="2014-06-02T14:01:39&#43;09:00"/>
<meta property="article:modified_time" content="2014-06-02T14:01:39&#43;09:00"/>

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="libGDX入門 その02 カメラとビューポート"/>
<meta name="twitter:description" content="はじめに libGDX を勉強するついでに解説記事を書く シリーズ 2回目です。
前回 は、プロジェクトを作って、以下のことを学びました。
 画像の表示 キーボードによる操作 BGMの再生 効果音の再生  今回は次のことを学びます。
 物理画面に依存しない画面表示 タッチ処理  物理画面に依存しない画面表示  物理画面とは何でしょうか？ここでは次のように定義します。 スマホやタブレット画面解像度 デスクトップのウィンドウサイズ Androidには様々な画面サイズがありますし、 iPhoneもモデルチェンジ毎に画面サイズが変化しています。 これら様々な画面サイズのことを考慮しないと、 意図した通りの画面が表示できません。  ゲームを作るときの基本として、物理画面でプログラムしないというのがあります。 物理的なディスプレイのサイズに依存した座標管理をすると、 移植性が下がり仕様変更に弱くなったり、 端末毎の画面サイズの違いを吸収できないプログラムになってしまいます。
例えば横スクロールアクションを作ったときに、 Aさんの画面は小さいから敵の動きがところ狭しとなるところが、 Bさんの端末だと画面が大きいからフィールドが遠くまで見わたせて楽々プレイできる、 なんてことが発生します。端末によって難易度が変わってくるのです。
https://zarudama.github.io/img/libgdx-beginner/2/screen2.png
実は既にこの問題は、私の手元で発生しています。 下記は、Nexus7(2013)で表示したサンプルの画面です。
http://zarudama.github.io/img/libgdx-beginner/2/004.png
/img/libgdx-beginner/2/003.png
Nexus7版は、PCの画面と全然違いますね。キャラクターや文字が非常に小さくなってます。 これはPC版が640x480の解像度なのに対して、Nexus7版は1920x1200の解像度で表示しているからです。 この状態でゲームを作ってしまったら全然別ものになってしまいますよね。 ちなみにMac持ってないのでiOS系ではどうなるかわかりません。
というわけで、どの端末でも公平に画面表示できるようにひと工夫必要になってきます (こういう処理は、ゲームづくりの序盤でやっておかないと、あとから変更するのは大変なので さっさと済ませておきたいことのひとつですね)。
カメラとビューポート ではどうやってこの問題を解決するか。それにはカメラとビューポートを使用します。
カメラとは、ゲームの世界を現実世界のディスプレイに届けるためのオブジェクトです。
ビューポートとは、カメラの捉えたゲームの世界を、ディスプレイのどこに表示するかを 決める枠(矩形領域)のことです。
https://zarudama.github.io/img/libgdx-beginner/2/screen3.png
ビューポートは、ディスプレイサイズと一致しているわけではないことに注意してください。 ゲームのサンプルなどだと一致していることが多いですが、 今回のように様々なディスプレイサイズに対応させる場合は、 一致しなくなることの方が多くなるはずです。また、他の使い方としては、 カメラを2つ用意して一方はゲーム画面、 一方は小さな枠で別のシーンを表示するなんてこともできるかもしれません(やったことないですが)。
 カメラを使うことにより、カメラとして定義した論理空間でゲームを制御できます。 この空間でやりとりすれば、あとはlibGDXがよろしく画面に表示してくれるわけです。 カメラでできることを列挙してみます。 物理的な画面サイズを気にせず、自分の定義した画面サイズでゲームを構築できる ズームイン、ズームアウト、画面を回転させたり、揺らしたりなど、画面全体にかかるエフェクトが簡単にできる カメラを動かすことで、スクロール処理が簡単に実装できる カメラを導入することでこのような自由が手に入るわけですが、 その代償として操作が複雑になってしまうのも事実です。 コーディング中は、今自分がどこの座標系で何を操作しているかを常に意識する必要があります。 ちょっと大袈裟ですが、慣れれば大したことありません。またこの考えはそのまま3Dプログラミングにも繋がります。   座標系には、以下の種類があります。 ワールド座標系。ゲームオブジェクトを置く論理空間。画面サイズは気にしなくて良い。 カメラ座標系。ワールドのゲームオブジェクトをカメラの枠での座標系で測りなおした座標系。真ん中が原点となる。 ビューポート座標系。左下を原点とした座標系。 スクリーン座標系。Android左上を原点とした最終的な座標系。タッチ座標などはOSからこの座標系の値が得られる。  ビューポート座標系とスクリーン座標系は他では別の呼びかたかもしれません。 座標系を意識する例を示します。"/>

<title>libGDX入門 その02 カメラとビューポート | ざる魂</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css" integrity="sha384-X38yfunGUhNzHpBaEBsWLO+A0HDYOQi8ufWDkZ0k9e0eXz/tH3II7uKZ9msv++Ls" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/grids-responsive-min.css">
<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<link rel="stylesheet" href="/css/zarudama.css">

<body><div class="header pure-u-1">
  <div class="container">
    <h1><a href="/"><img src="/img/logo.png" alt="" class="logo">ざる魂</a></h1>
    <p>真似ぶ魂、学ぶの本質</p>
  </div>
</div>
<div class="menu pure-u-1">
  <div class="container">
    <ul>
      <li><a href="/search">全文検索</a></li>
      <li><a href="/posts">全ページ一覧</a></li>
      <li><a href="/tags">タグ一覧</a></li>
      <li><a href="/about">このサイトについて</a></li>
    </ul>
  </div>
</div>
<article>
        <div class="container">
<div class="title pure-u-1">
  <h1 id="title">libGDX入門 その02 カメラとビューポート</h1>
  <aside id="meta"><a class="tags" href="/tags/libgdx%E5%85%A5%E9%96%80">libGDX入門</a><a class="tags" href="/tags/libgdx">libGDX</a>
<section>
      <span class="date">作成日: 2014-06-02</span>&nbsp;&nbsp;
      <span class="date">最終更新日: 2014-06-02</span>&nbsp;&nbsp;
      <sapn class="wordcount"> &lt;1211 文字> </span>
    </section>
    
  </aside>
</div>
<div class="content pure-u-1">
    
    
    
    
      <h1 id="はじめに">はじめに</h1>

<p><a href="https://libgdx.com/" title="libGDX">libGDX</a> を勉強するついでに解説記事を書く <a href="/tags/libgdx入門/" title="シリーズ">シリーズ</a> 2回目です。</p>

<p><a href="/posts/libgdx-beginner1/" title="前回">前回</a> は、プロジェクトを作って、以下のことを学びました。</p>

<ul>
<li>画像の表示</li>
<li>キーボードによる操作</li>
<li>BGMの再生</li>
<li>効果音の再生</li>
</ul>

<p>今回は次のことを学びます。</p>

<ul>
<li>物理画面に依存しない画面表示</li>
<li>タッチ処理</li>
</ul>

<h1 id="物理画面に依存しない画面表示">物理画面に依存しない画面表示</h1>

<ul>
物理画面とは何でしょうか？ここでは次のように定義します。
<li>スマホやタブレット画面解像度</li>
<li>デスクトップのウィンドウサイズ</li>
Androidには様々な画面サイズがありますし、
iPhoneもモデルチェンジ毎に画面サイズが変化しています。
これら様々な画面サイズのことを考慮しないと、
意図した通りの画面が表示できません。
</ul>

<p>ゲームを作るときの基本として、物理画面でプログラムしないというのがあります。
物理的なディスプレイのサイズに依存した座標管理をすると、
移植性が下がり仕様変更に弱くなったり、
端末毎の画面サイズの違いを吸収できないプログラムになってしまいます。</p>

<p>例えば横スクロールアクションを作ったときに、
Aさんの画面は小さいから敵の動きがところ狭しとなるところが、
Bさんの端末だと画面が大きいからフィールドが遠くまで見わたせて楽々プレイできる、
なんてことが発生します。端末によって難易度が変わってくるのです。</p>

<p><a href="https://zarudama.github.io/img/libgdx-beginner/2/screen2.png" title="https://zarudama.github.io/img/libgdx-beginner/2/screen2.png">https://zarudama.github.io/img/libgdx-beginner/2/screen2.png</a></p>

<p>実は既にこの問題は、私の手元で発生しています。
下記は、Nexus7(2013)で表示したサンプルの画面です。</p>

<p><a href="http://zarudama.github.io/img/libgdx-beginner/2/004.png" title="http://zarudama.github.io/img/libgdx-beginner/2/004.png">http://zarudama.github.io/img/libgdx-beginner/2/004.png</a></p>

<p><a href="/img/libgdx-beginner/2/003.png" title="/img/libgdx-beginner/2/003.png">/img/libgdx-beginner/2/003.png</a></p>

<p>Nexus7版は、PCの画面と全然違いますね。キャラクターや文字が非常に小さくなってます。
これはPC版が640x480の解像度なのに対して、Nexus7版は1920x1200の解像度で表示しているからです。
この状態でゲームを作ってしまったら全然別ものになってしまいますよね。
ちなみにMac持ってないのでiOS系ではどうなるかわかりません。</p>

<p>というわけで、どの端末でも公平に画面表示できるようにひと工夫必要になってきます
(こういう処理は、ゲームづくりの序盤でやっておかないと、あとから変更するのは大変なので
さっさと済ませておきたいことのひとつですね)。</p>

<h1 id="カメラとビューポート">カメラとビューポート</h1>

<p>ではどうやってこの問題を解決するか。それにはカメラとビューポートを使用します。</p>

<p>カメラとは、ゲームの世界を現実世界のディスプレイに届けるためのオブジェクトです。</p>

<p>ビューポートとは、カメラの捉えたゲームの世界を、ディスプレイのどこに表示するかを
決める枠(矩形領域)のことです。</p>

<p><a href="https://zarudama.github.io/img/libgdx-beginner/2/screen3.png" title="https://zarudama.github.io/img/libgdx-beginner/2/screen3.png">https://zarudama.github.io/img/libgdx-beginner/2/screen3.png</a></p>

<p>ビューポートは、ディスプレイサイズと一致しているわけではないことに注意してください。
ゲームのサンプルなどだと一致していることが多いですが、
今回のように様々なディスプレイサイズに対応させる場合は、
一致しなくなることの方が多くなるはずです。また、他の使い方としては、
カメラを2つ用意して一方はゲーム画面、
一方は小さな枠で別のシーンを表示するなんてこともできるかもしれません(やったことないですが)。</p>

<ul>
カメラを使うことにより、カメラとして定義した論理空間でゲームを制御できます。
この空間でやりとりすれば、あとはlibGDXがよろしく画面に表示してくれるわけです。
カメラでできることを列挙してみます。
<li>物理的な画面サイズを気にせず、自分の定義した画面サイズでゲームを構築できる</li>
<li>ズームイン、ズームアウト、画面を回転させたり、揺らしたりなど、画面全体にかかるエフェクトが簡単にできる</li>
<li>カメラを動かすことで、スクロール処理が簡単に実装できる</li>
カメラを導入することでこのような自由が手に入るわけですが、
その代償として操作が複雑になってしまうのも事実です。
コーディング中は、今自分がどこの座標系で何を操作しているかを常に意識する必要があります。
ちょっと大袈裟ですが、慣れれば大したことありません。またこの考えはそのまま3Dプログラミングにも繋がります。
</ul>

<ul>
座標系には、以下の種類があります。
<li>ワールド座標系。ゲームオブジェクトを置く論理空間。画面サイズは気にしなくて良い。</li>
<li>カメラ座標系。ワールドのゲームオブジェクトをカメラの枠での座標系で測りなおした座標系。真ん中が原点となる。</li>
<li>ビューポート座標系。左下を原点とした座標系。</li>
<li>スクリーン座標系。Android左上を原点とした最終的な座標系。タッチ座標などはOSからこの座標系の値が得られる。</li>
</ul>

<p>ビューポート座標系とスクリーン座標系は他では別の呼びかたかもしれません。
座標系を意識する例を示します。</p>

<p>たとえば、画面をタッチして、その座標にキャラクターが向って行くのであれば、
タッチ操作で得られた座標(スクリーン座標系)をワールド座標系に変換する必要があります。</p>

<p>逆にワールドに落ちているコインなどのアイテムを画面UIのスコア表示に
吸いこまれるようなエフェクトをかけるときは、ワールドからスクリーンへの変換が必要になるでしょう。</p>

<p>カメラを使用しなくてもゲームは作れますが、いろいろと応用が効くので、
パズルゲームのような固定画面のゲームしか使わない予定であっても、
使いかたに慣れておいたほうが良いと思います。</p>

<h1 id="実際のコーディング">実際のコーディング</h1>

<p>講釈が多くなってしまいました。実際のコーディングに進みます。
まずゲームに使用する画面解像度を決定します。
これは、物理的なサイズではなく、論理的なものです。
今回は下記のように定義しました。</p>

<ul>
<li>横800 x 縦480</li>
</ul>

<p>横長の割と無難なサイズです。</p>

<h2 id="カメラの導入">カメラの導入</h2>

<p>では早速カメラを導入してみましょう。
前回のソースコードに手を入れていきます。
前回のサンプルでは、画面サイズはデフォルトのままでしたが、
今回はターゲットサイズを横800 x 縦480に設定したので、
createメソッド内でカメラを下記のように定義します。</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  OrthographicCamera camera<span style="color:#555">;</span>

  <span style="color:#99f">@Override</span>
  <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">create</span> <span style="color:#555">()</span> <span style="color:#555">{</span>
    <span style="color:#a00;background-color:#faa">：</span>
    camera <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> OrthographicCamera<span style="color:#555">(</span>800<span style="color:#555">,</span> 480<span style="color:#555">);</span>
    <span style="color:#a00;background-color:#faa">：</span>
  <span style="color:#555">}</span></code></pre></div>
<p>フィールドに <code>camera</code> を追加しています。
ちなみになぜこんな長たらしい名前がついてるのかわかりませんが、
2D用のカメラは、 <code>OrthographicCamera</code> クラスといいます。
libGDXのソースコードを見渡しましたが、他に2D用のカメラは見当たらなかったので
=OrthographicCamera= は2D専用と思って問題ないでしょう。</p>

<p>続いて、描画にカメラを反映させるため、 <code>render</code> メソッドを変更します。</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#99f">@Override</span>
<span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">render</span><span style="color:#555">()</span> <span style="color:#555">{</span>
    <span style="color:#555">:</span>
  Gdx<span style="color:#555">.</span><span style="color:#309">gl</span><span style="color:#555">.</span><span style="color:#309">glClearColor</span><span style="color:#555">(</span>1<span style="color:#555">,</span> 0<span style="color:#555">,</span> 0<span style="color:#555">,</span> 1<span style="color:#555">);</span>
  Gdx<span style="color:#555">.</span><span style="color:#309">gl</span><span style="color:#555">.</span><span style="color:#309">glClear</span><span style="color:#555">(</span>GL20<span style="color:#555">.</span><span style="color:#309">GL_COLOR_BUFFER_BIT</span><span style="color:#555">);</span>
  camera<span style="color:#555">.</span><span style="color:#309">update</span><span style="color:#555">();</span> <span style="color:#09f;font-style:italic">// 追加 #1
</span><span style="color:#09f;font-style:italic"></span>  batch<span style="color:#555">.</span><span style="color:#309">setProjectionMatrix</span><span style="color:#555">(</span>camera<span style="color:#555">.</span><span style="color:#309">combined</span><span style="color:#555">);</span> <span style="color:#09f;font-style:italic">// 追加 #2
</span><span style="color:#09f;font-style:italic"></span>  batch<span style="color:#555">.</span><span style="color:#309">begin</span><span style="color:#555">();</span>
  sprite<span style="color:#555">.</span><span style="color:#309">draw</span><span style="color:#555">(</span>batch<span style="color:#555">);</span>
    <span style="color:#555">:</span>
<span style="color:#555">}</span></code></pre></div>
<p><code>#1</code> でカメラ自身の座標計算(行列演算)をし、 <code>#2</code> でその結果をスプライトに適用させる準備をします。
この処理は定型処理なので、最初のうちは決めごとと思って問題ありません。</p>

<p>ここまでの実行結果は下記のとおりです。</p>

<p><a href="https://zarudama.github.io/img/libgdx-beginner/2/005.png" title="https://zarudama.github.io/img/libgdx-beginner/2/005.png">https://zarudama.github.io/img/libgdx-beginner/2/005.png</a></p>

<p>なにか変です。画像のサイズが以前に比べて縦長になっています。なぜでしょうか？</p>

<h2 id="ビューポートの導入">ビューポートの導入</h2>

<p>原因はビューポートの設定にあります。libGDXは、デフォルトのビューポート設定だと、
物理画面いっぱいに最終画像を引き伸ばします。
今回の場合、カメラの設定を <code>800x480</code> に設定したのに対し、
実際のウィンドウサイズが <code>640 x 480</code> のため歪みがでてしまったのです(横方向に潰れている)。</p>

<p>では、ビューポートはどのように設定すれば良いのでしょうか？
libGDXは、OpenGLを直接操作する低レイヤのメソッドも用意してますので、
自分で直接ビューポートをやりくりすることもできます。
しかし、libGDXには、このような面倒な作業を請け負ってくれる、
高レイヤの <code>ViewPort</code> クラスがあります。
今回は、この便利クラスを使うことにしましょう。</p>

<p>フィールドに <code>viewport</code> を追加し、createメソッド内で
ビューポートを定義します。</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  OrthographicCamera camera<span style="color:#555">;</span>
  Viewport viewport<span style="color:#555">;</span>  <span style="color:#09f;font-style:italic">// 追加
</span><span style="color:#09f;font-style:italic"></span>  <span style="color:#99f">@Override</span>
  <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">create</span> <span style="color:#555">()</span> <span style="color:#555">{</span>
    <span style="color:#a00;background-color:#faa">：</span>
    camera <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> OrthographicCamera<span style="color:#555">(</span>800<span style="color:#555">,</span> 480<span style="color:#555">);</span>
    viewport <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> FitViewport<span style="color:#555">(</span>800<span style="color:#555">,</span> 480<span style="color:#555">,</span> camera<span style="color:#555">);</span> <span style="color:#09f;font-style:italic">// 追加
</span><span style="color:#09f;font-style:italic"></span>    <span style="color:#a00;background-color:#faa">：</span>
  <span style="color:#555">}</span></code></pre></div>
<p><code>ViewPort</code> はスーパークラスであり、このクラスを継承した様々なクラスがあります。
インスンタンスを設定する際には、用途に応じたViewPort継承クラスを指定する必要があります。
今回は、 <code>FitViewport</code> クラスを利用します。</p>

<p>続いて <code>resize</code> メソッドを追加します。 <code>resize</code> メソッドは、 <code>ApplicationListener</code> クラスのメソッドであり、
画面の向きが変わったり、アプリケーションが起動したタイミングなどで呼ばれます。</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  <span style="color:#99f">@Override</span>
  <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">resize</span><span style="color:#555">(</span><span style="color:#078;font-weight:bold">int</span> width<span style="color:#555">,</span> <span style="color:#078;font-weight:bold">int</span> height<span style="color:#555">)</span> <span style="color:#555">{</span>
      viewport<span style="color:#555">.</span><span style="color:#309">update</span><span style="color:#555">(</span>width<span style="color:#555">,</span> height<span style="color:#555">);</span> 
  <span style="color:#555">}</span></code></pre></div>
<p>ビューポートは画面の大きさが変化した時だけ設定すれば良いため、
 <code>resize</code> メソッドから呼びだすだけでよく、 <code>render</code> メソッドなどで呼びだす必要はありません。</p>

<p>ここまでの実行結果は下記のとおりです。</p>

<p><a href="https://zarudama.github.io/img/libgdx-beginner/2/006.png" title="https://zarudama.github.io/img/libgdx-beginner/2/006.png">https://zarudama.github.io/img/libgdx-beginner/2/006.png</a></p>

<p>やった、歪みがなくなりました! 
しかし、ここでひとつおかしいことに気づかないでしょうか？
カメラとビューポートのサイズには <code>800x480</code> を設定しました。
でも、このサンプルのウィンドウサイズは <code>640x480</code> です。なぜ表示できるんでしょうか？</p>

<p>このままでは、背景となる塗りつぶし色の赤と、ビューポートの枠の区別がつきにくため、
ビューポートの働きがわかりつらくなっています。
そこで、 <code>FitViewPort</code> の動きを分かりやすくするために、大きなサイズの画像を背景として表示してみます。</p>

<h1 id="背景の追加">背景の追加</h1>

<p>背景用に次の画像を「右クリ→名前をつけて保存」で保存してください。</p>

<p><a href="https://zarudama.github.io/img/libgdx-beginner/2/bg.png" title="https://zarudama.github.io/img/libgdx-beginner/2/bg.png">https://zarudama.github.io/img/libgdx-beginner/2/bg.png</a></p>

<p>保存したファイルを下記に追加してください。</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">~/dev/libgdxtest/android/assets/</code></pre></div>
<p>下記のように変更します。</p>

<p>フィールド</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  Texture bgImg<span style="color:#555">;</span> <span style="color:#09f;font-style:italic">// 追加
</span><span style="color:#09f;font-style:italic"></span>  Sprite bg<span style="color:#555">;</span>     <span style="color:#555">//</span> 追加</code></pre></div>
<p><code>create</code> メソッド</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  <span style="color:#99f">@Override</span>
  <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">create</span> <span style="color:#555">()</span> <span style="color:#555">{</span>
      <span style="color:#555">:</span>
     <span style="color:#09f;font-style:italic">// 追加
</span><span style="color:#09f;font-style:italic"></span>     bgImg <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> Texture<span style="color:#555">(</span><span style="color:#c30">&#34;bg.png&#34;</span><span style="color:#555">);</span>
     bg <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> Sprite<span style="color:#555">(</span>bgImg<span style="color:#555">);</span>
     bg<span style="color:#555">.</span><span style="color:#309">setScale</span><span style="color:#555">(</span>2<span style="color:#555">.</span><span style="color:#309">0f</span><span style="color:#555">,</span> 2<span style="color:#555">.</span><span style="color:#309">0f</span><span style="color:#555">);</span>
     bg<span style="color:#555">.</span><span style="color:#309">setPosition</span><span style="color:#555">(-</span>400<span style="color:#555">,</span> <span style="color:#555">-</span>240<span style="color:#555">);</span>
      <span style="color:#555">:</span></code></pre></div>
<p><code>render</code> メソッド</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  <span style="color:#99f">@Override</span>
  <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">render</span><span style="color:#555">()</span> <span style="color:#555">{</span>
      <span style="color:#555">:</span>
	batch<span style="color:#555">.</span><span style="color:#309">setProjectionMatrix</span><span style="color:#555">(</span>camera<span style="color:#555">.</span><span style="color:#309">combined</span><span style="color:#555">);</span>
      batch<span style="color:#555">.</span><span style="color:#309">begin</span><span style="color:#555">();</span>
      bg<span style="color:#555">.</span><span style="color:#309">draw</span><span style="color:#555">(</span>batch<span style="color:#555">);</span> <span style="color:#09f;font-style:italic">// 追加
</span><span style="color:#09f;font-style:italic"></span>      sprite<span style="color:#555">.</span><span style="color:#309">draw</span><span style="color:#555">(</span>batch<span style="color:#555">);</span>
      sprite2<span style="color:#555">.</span><span style="color:#309">draw</span><span style="color:#555">(</span>batch<span style="color:#555">);</span>
      <span style="color:#555">:</span></code></pre></div>
<p><code>dispose</code> メソッド</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  <span style="color:#99f">@Override</span>
  <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">dispose</span><span style="color:#555">()</span> <span style="color:#555">{</span>
       <span style="color:#555">:</span>
      bgImg<span style="color:#555">.</span><span style="color:#309">dispose</span><span style="color:#555">();</span>
  <span style="color:#555">}</span></code></pre></div>
<p>これで実行してみます。</p>

<p><a href="http://zarudama.github.io/img/libgdx-beginner/2/007.png" title="http://zarudama.github.io/img/libgdx-beginner/2/007.png">http://zarudama.github.io/img/libgdx-beginner/2/007.png</a></p>

<p>するとどうでしょう？赤い枠が上下に出現しています。
これは、 <code>FitViewPort</code> がウィンドウサイズからビューポートのサイズを自動計算して
当初の縦横比を保ってくれるからなのです。</p>

<p>試しにウィンドウサイズを色々マウスでドラッグして変化させてみてください。</p>

<p><a href="/img/libgdx-beginner/2/008.png" title="/img/libgdx-beginner/2/008.png">/img/libgdx-beginner/2/008.png</a></p>

<p><a href="/img/libgdx-beginner/2/009.png" title="/img/libgdx-beginner/2/009.png">/img/libgdx-beginner/2/009.png</a></p>

<p>こんな風に画面のサイズに応じて、ビューポートのサイズを動的に変化さてくれます。
画面の短い辺に対して最大のサイズを割りあて、長い辺に大してはその比率を調整するようですね。</p>

<p>もちろんNexus7の実機でもうまく表示できています。</p>

<p><a href="/img/libgdx-beginner/2/nexus7.png" title="/img/libgdx-beginner/2/nexus7.png">/img/libgdx-beginner/2/nexus7.png</a></p>

<p>このように、 <code>FitViewPort</code> クラスを使うことにより、どのような画面サイズであっても、
こちらの意図したとおりの画面比率で表示されるようになります。</p>

<ul>
<code>ViewPort</code> クラスには他にも様々な種類のクラスがあります。
いろいろ試してみてください。
<li>https://libgdx.com/wiki/graphics/viewports</li>
</ul>

<h1 id="カメラの位置調整">カメラの位置調整</h1>

<p>以上で、カメラとビューポートの導入を終えたのですが、まだおかしいところがあります。
どこでしょうか？</p>

<p>実はスプライト画像がひとつしか表示されてません。本来は2つ表示されているハズなのですが。
最初の時はこうでした。</p>

<p><a href="/img/libgdx-beginner/2/003.png" title="/img/libgdx-beginner/2/003.png">/img/libgdx-beginner/2/003.png</a></p>

<p>何が起きているかというと、カメラの位置がおかしいのです。
カメラはスプライトと違って、真ん中が原点となります。
なので、ワールド原点を中心とした枠が表示されているのです。</p>

<p><a href="/img/libgdx-beginner/2/010.png" title="/img/libgdx-beginner/2/010.png">/img/libgdx-beginner/2/010.png</a></p>

<h2 id="ワールド軸の描画">ワールド軸の描画</h2>

<p>左上が(-400,240),右上が(400,240),右下が(400,-240),左下が(-400,-240)の枠となっています。
このために2つめのスプライトがちょうど右上の枠の外に位置しており、画面から消えてしまっているのです。
ここで、見た目をわかりやすくするためにワールドの座標軸を描画してみます。</p>

<p>インポート</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.graphics.glutils.ShapeRenderer</span><span style="color:#555">;</span></code></pre></div>
<p>フィールド</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  ShapeRenderer shapeRenderer<span style="color:#555">;</span> <span style="color:#555">//</span> 追加</code></pre></div>
<p><code>create</code> メソッド</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  <span style="color:#99f">@Override</span>
  <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">create</span> <span style="color:#555">()</span> <span style="color:#555">{</span>
      <span style="color:#555">:</span>
     <span style="color:#09f;font-style:italic">// 追加
</span><span style="color:#09f;font-style:italic"></span>     shapeRenderer <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> ShapeRenderer<span style="color:#555">();</span>
      <span style="color:#555">:</span></code></pre></div>
<p><code>render</code> メソッド</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  <span style="color:#99f">@Override</span>
  <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">render</span><span style="color:#555">()</span> <span style="color:#555">{</span>
      <span style="color:#555">:</span>
    <span style="color:#09f;font-style:italic">// ワールド座標軸を描画する。
</span><span style="color:#09f;font-style:italic"></span>    shapeRenderer<span style="color:#555">.</span><span style="color:#309">setProjectionMatrix</span><span style="color:#555">(</span>camera<span style="color:#555">.</span><span style="color:#309">combined</span><span style="color:#555">);</span>
    shapeRenderer<span style="color:#555">.</span><span style="color:#309">begin</span><span style="color:#555">(</span>ShapeRenderer<span style="color:#555">.</span><span style="color:#309">ShapeType</span><span style="color:#555">.</span><span style="color:#309">Line</span><span style="color:#555">);</span>
    shapeRenderer<span style="color:#555">.</span><span style="color:#309">setColor</span><span style="color:#555">(</span>1<span style="color:#555">,</span> 0<span style="color:#555">,</span> 0<span style="color:#555">,</span> 1<span style="color:#555">);</span>
    shapeRenderer<span style="color:#555">.</span><span style="color:#309">line</span><span style="color:#555">(-</span>1024<span style="color:#555">,</span> 0<span style="color:#555">,</span> 1024<span style="color:#555">,</span> 0<span style="color:#555">);</span>
    shapeRenderer<span style="color:#555">.</span><span style="color:#309">setColor</span><span style="color:#555">(</span>0<span style="color:#555">,</span> 1<span style="color:#555">,</span> 0<span style="color:#555">,</span> 1<span style="color:#555">);</span>
    shapeRenderer<span style="color:#555">.</span><span style="color:#309">line</span><span style="color:#555">(</span>0<span style="color:#555">,</span> <span style="color:#555">-</span>1024<span style="color:#555">,</span> 0<span style="color:#555">,</span> 1024<span style="color:#555">);</span>
    shapeRenderer<span style="color:#555">.</span><span style="color:#309">end</span><span style="color:#555">();</span>
      <span style="color:#555">:</span></code></pre></div>
<p><code>dispose</code> メソッド</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  <span style="color:#99f">@Override</span>
  <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">dispose</span><span style="color:#555">()</span> <span style="color:#555">{</span>
       <span style="color:#555">:</span>
     shapeRenderer<span style="color:#555">.</span><span style="color:#309">dispose</span><span style="color:#555">();</span>
  <span style="color:#555">}</span></code></pre></div>
<p>これで実行してみます。</p>

<p><a href="/img/libgdx-beginner/2/012.png" title="/img/libgdx-beginner/2/012.png">/img/libgdx-beginner/2/012.png</a></p>

<p>X軸を赤、Y軸を緑で描画しています。
これで状況がよりわかりやすくなったと思います。</p>

<h2 id="settoorthメソッド">setToOrthメソッド</h2>

<p>画面の原点を左下に調整するというのはよくあることなので、
専用のメソッドが用意されています。</p>

<p>そこで試しに下記のメソッドを追記してみましょう。</p>

<p><code>create</code> メソッド</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  <span style="color:#99f">@Override</span>
  <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">create</span> <span style="color:#555">()</span> <span style="color:#555">{</span>
      <span style="color:#555">:</span>
     camera <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> OrthographicCamera<span style="color:#555">(</span>800<span style="color:#555">,</span>480<span style="color:#555">);</span>
     camera<span style="color:#555">.</span><span style="color:#309">setToOrtho</span><span style="color:#555">(</span><span style="color:#069;font-weight:bold">false</span><span style="color:#555">,</span> 800<span style="color:#555">,</span> 480<span style="color:#555">);</span>    <span style="color:#09f;font-style:italic">// 追加
</span><span style="color:#09f;font-style:italic"></span>      <span style="color:#555">:</span>
  <span style="color:#555">}</span></code></pre></div>
<p><code>Camera#setToOrtho</code> メソッドは、カメラを右上に移動させて、左下に丁度ワールド原点がくるように調整するものです。
第1引数は、ydownといって、trueにするとY軸が反転されますが、通常はfalseで良いと思います。
第2引数と第3引数は、カメラのの幅と高さです。 <code>setToOrth</code> をコンストラクタに続けて指定する時は、
コンストラクタには、サイズ指定はいらないですね(今回は修正が面倒なのでそのまま)。</p>

<p>これを実行すると以下のように表示されます。</p>

<p><a href="/img/libgdx-beginner/2/013.png" title="/img/libgdx-beginner/2/013.png">/img/libgdx-beginner/2/013.png</a></p>

<p>無事カメラが移動されて、2つ目のスプライトも表示されるようになりました。</p>

<h1 id="カメラを動かす">カメラを動かす</h1>

<p>こんどはカメラをキーボードで動かしてみましょう。</p>

<p><code>render</code> メソッドで下記のように追記します。</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  <span style="color:#99f">@Override</span>
  <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">render</span><span style="color:#555">()</span> <span style="color:#555">{</span>
      <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">isKeyPressed</span><span style="color:#555">(</span>Input<span style="color:#555">.</span><span style="color:#309">Keys</span><span style="color:#555">.</span><span style="color:#309">LEFT</span><span style="color:#555">))</span> <span style="color:#555">{</span>
          <span style="color:#09f;font-style:italic">//pos.x -= 1;            // 削除
</span><span style="color:#09f;font-style:italic"></span>          camera<span style="color:#555">.</span><span style="color:#309">position</span><span style="color:#555">.</span><span style="color:#309">x</span> <span style="color:#555">-=</span> 2<span style="color:#555">;</span>  <span style="color:#09f;font-style:italic">// 追加
</span><span style="color:#09f;font-style:italic"></span>      <span style="color:#555">}</span>
      <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">isKeyPressed</span><span style="color:#555">(</span>Input<span style="color:#555">.</span><span style="color:#309">Keys</span><span style="color:#555">.</span><span style="color:#309">RIGHT</span><span style="color:#555">))</span> <span style="color:#555">{</span>
          <span style="color:#09f;font-style:italic">//pos.x += 1;            // 削除
</span><span style="color:#09f;font-style:italic"></span>          camera<span style="color:#555">.</span><span style="color:#309">position</span><span style="color:#555">.</span><span style="color:#309">x</span> <span style="color:#555">+=</span> 2<span style="color:#555">;</span>  <span style="color:#09f;font-style:italic">// 追加
</span><span style="color:#09f;font-style:italic"></span>      <span style="color:#555">}</span>
      <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">isKeyPressed</span><span style="color:#555">(</span>Input<span style="color:#555">.</span><span style="color:#309">Keys</span><span style="color:#555">.</span><span style="color:#309">UP</span><span style="color:#555">))</span> <span style="color:#555">{</span>
          <span style="color:#09f;font-style:italic">//pos.y += 1;            // 削除
</span><span style="color:#09f;font-style:italic"></span>          camera<span style="color:#555">.</span><span style="color:#309">position</span><span style="color:#555">.</span><span style="color:#309">y</span> <span style="color:#555">+=</span> 2<span style="color:#555">;</span>  <span style="color:#09f;font-style:italic">// 追加
</span><span style="color:#09f;font-style:italic"></span>      <span style="color:#555">}</span>
      <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">isKeyPressed</span><span style="color:#555">(</span>Input<span style="color:#555">.</span><span style="color:#309">Keys</span><span style="color:#555">.</span><span style="color:#309">DOWN</span><span style="color:#555">))</span> <span style="color:#555">{</span>
          <span style="color:#09f;font-style:italic">//pos.y -= 1;            // 削除
</span><span style="color:#09f;font-style:italic"></span>          camera<span style="color:#555">.</span><span style="color:#309">position</span><span style="color:#555">.</span><span style="color:#309">y</span> <span style="color:#555">-=</span> 2<span style="color:#555">;</span>  <span style="color:#09f;font-style:italic">// 追加
</span><span style="color:#09f;font-style:italic"></span>      <span style="color:#555">}</span></code></pre></div>
<p><code>pos</code> ベクトルへの処理を削除し、変わりに <code>camera.position</code> への処理を追加します。
これを実行すると以下のように表示されます。</p>

<p><a href="/img/libgdx-beginner/2/014.png" title="/img/libgdx-beginner/2/014.png">/img/libgdx-beginner/2/014.png</a></p>

<p>カーソルキーでカメラを動かしてみてください。
背景のBG画像があまり大きくないので端にいくと表示が変な見ためになるので注意です。</p>

<p>ここで、カメラが本当に動いているのか数値からも判断するため、
カメラの座標を表示してみます。</p>

<p><code>render</code> メソッドで下記のように追記します。</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  <span style="color:#99f">@Override</span>
  <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">render</span><span style="color:#555">()</span> <span style="color:#555">{</span>
    <span style="color:#a00;background-color:#faa">：</span>
    <span style="color:#09f;font-style:italic">// カメラの座標の文字列を作って
</span><span style="color:#09f;font-style:italic"></span>    String info <span style="color:#555">=</span> String<span style="color:#555">.</span><span style="color:#309">format</span><span style="color:#555">(</span><span style="color:#c30">&#34;cam pos(%f,%f)&#34;</span><span style="color:#555">,</span> camera<span style="color:#555">.</span><span style="color:#309">position</span><span style="color:#555">.</span><span style="color:#309">x</span><span style="color:#555">,</span> camera<span style="color:#555">.</span><span style="color:#309">position</span><span style="color:#555">.</span><span style="color:#309">y</span><span style="color:#555">);</span>


    batch<span style="color:#555">.</span><span style="color:#309">setProjectionMatrix</span><span style="color:#555">(</span>camera<span style="color:#555">.</span><span style="color:#309">combined</span><span style="color:#555">);</span>
    batch<span style="color:#555">.</span><span style="color:#309">begin</span><span style="color:#555">();</span>
        <span style="color:#a00;background-color:#faa">：</span>
    font<span style="color:#555">.</span><span style="color:#309">draw</span><span style="color:#555">(</span>batch<span style="color:#555">,</span> info<span style="color:#555">,</span> 0<span style="color:#555">,</span> 20<span style="color:#555">);</span> <span style="color:#09f;font-style:italic">// 追加
</span><span style="color:#09f;font-style:italic"></span>        <span style="color:#a00;background-color:#faa">：</span>
    batch<span style="color:#555">.</span><span style="color:#309">begin</span><span style="color:#555">();</span></code></pre></div>
<p>座標は大体左したに表示されるように指定しています。</p>

<p>これを実行すると以下のように表示されます。</p>

<p><a href="/img/libgdx-beginner/2/015.png" title="/img/libgdx-beginner/2/015.png">/img/libgdx-beginner/2/015.png</a></p>

<p>左下に表示されてますね。ではカーソルキーでカメラを動かしてみてください。</p>

<p><a href="/img/libgdx-beginner/2/016.png" title="/img/libgdx-beginner/2/016.png">/img/libgdx-beginner/2/016.png</a></p>

<p>あれ、期待した動きと違ってませんか？ 私は違いました。
どう動いて欲しかったというと、画面にひっついて常に左下に表示して欲しいと思いました。</p>

<p>実は、このフォント描画はワールド座標に対して行なわれているのです。
フォント文字もワールドに存在するスプライトと同じオブジェクトとして
描画されているんですね。</p>

<p>これを画面にひっつかせて描画させるには、ひと工夫必要です。</p>

<h1 id="ui用カメラの導入">UI用カメラの導入</h1>

<p>答えは簡単です。もうひとつカメラを用意すれば良いのです。
UI専用のカメラを準備して、そのカメラは動かさずにおく。
これだけでオッケーです(libGDXのサンプルでもやっている方法です)。</p>

<p>フィールド</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  OrthographicCamera uiCamera<span style="color:#555">;</span>  <span style="color:#555">//</span> 追加</code></pre></div>
<p><code>create</code> メソッド</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  <span style="color:#99f">@Override</span>
  <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">create</span> <span style="color:#555">()</span> <span style="color:#555">{</span>
      <span style="color:#555">:</span>
     <span style="color:#09f;font-style:italic">// 追加
</span><span style="color:#09f;font-style:italic"></span>     uiCamera <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> OrthographicCamera<span style="color:#555">();</span>
     uiCamera<span style="color:#555">.</span><span style="color:#309">setToOrtho</span><span style="color:#555">(</span><span style="color:#069;font-weight:bold">false</span><span style="color:#555">,</span> 800<span style="color:#555">,</span> 480<span style="color:#555">);</span>
      <span style="color:#555">:</span></code></pre></div>
<p><code>render</code> メソッド</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  <span style="color:#99f">@Override</span>
  <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">render</span><span style="color:#555">()</span> <span style="color:#555">{</span>
      <span style="color:#555">:</span>
    <span style="color:#09f;font-style:italic">//font.draw(batch, info, 0, 20);
</span><span style="color:#09f;font-style:italic"></span>    <span style="color:#09f;font-style:italic">//font.draw(batch, &#34;Hello libGDX&#34;, 200, 400);
</span><span style="color:#09f;font-style:italic"></span>      <span style="color:#555">:</span>
    <span style="color:#09f;font-style:italic">// render の一番最後で描画すること
</span><span style="color:#09f;font-style:italic"></span>    uiCamera<span style="color:#555">.</span><span style="color:#309">update</span><span style="color:#555">();</span>
	batch<span style="color:#555">.</span><span style="color:#309">setProjectionMatrix</span><span style="color:#555">(</span>uiCamera<span style="color:#555">.</span><span style="color:#309">combined</span><span style="color:#555">);</span>
    batch<span style="color:#555">.</span><span style="color:#309">begin</span><span style="color:#555">();</span>
    font<span style="color:#555">.</span><span style="color:#309">draw</span><span style="color:#555">(</span>batch<span style="color:#555">,</span> info<span style="color:#555">,</span> 0<span style="color:#555">,</span> 20<span style="color:#555">);</span>
    font<span style="color:#555">.</span><span style="color:#309">draw</span><span style="color:#555">(</span>batch<span style="color:#555">,</span> <span style="color:#c30">&#34;Hello libGDX&#34;</span><span style="color:#555">,</span> 200<span style="color:#555">,</span> 400<span style="color:#555">);</span>
    batch<span style="color:#555">.</span><span style="color:#309">end</span><span style="color:#555">();</span>
  <span style="color:#555">}</span></code></pre></div>
<p>以前の <code>font.draw</code> はコメントアウトもしくは、削除します。
注意すべき点は、UIの描画物は <code>render</code> メソッド内の一番最後で描画するということです。
これは、画面上の一番上に描画するためです。</p>

<p>実行してみます。</p>

<p><a href="/img/libgdx-beginner/2/017.png" title="/img/libgdx-beginner/2/017.png">/img/libgdx-beginner/2/017.png</a></p>

<p>おおお、無事希望どおりの動きになりました!</p>

<p>さて、ここで気になることがあります。
それは、画面サイズとして <code>800x480</code> を指定しているにも関わらず、
ウィンドウサイズが <code>640x480</code> のままだということです。</p>

<h2 id="windowサイズの変更">Windowサイズの変更</h2>

<p>スマホなどの端末は、ハードウェアなので画面サイズを変更できませんが、
Desktop版は、ウィンドウなので、初期サイズを変更できます。</p>

<p>下記のファイルを編集すればオッケーです。</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">~/dev/libgdxtest/desktop/src/com/zarudama/libgdxtest/desktop/DesktopLauncher.java</code></pre></div><div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">class</span> <span style="color:#0a8;font-weight:bold">DesktopLauncher</span> <span style="color:#555">{</span>
	<span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">main</span> <span style="color:#555">(</span>String<span style="color:#555">[]</span> arg<span style="color:#555">)</span> <span style="color:#555">{</span>
		LwjglApplicationConfiguration config <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> LwjglApplicationConfiguration<span style="color:#555">();</span>
		config<span style="color:#555">.</span><span style="color:#309">width</span> <span style="color:#555">=</span> 800<span style="color:#555">;</span>  <span style="color:#09f;font-style:italic">// 追加
</span><span style="color:#09f;font-style:italic"></span>		config<span style="color:#555">.</span><span style="color:#309">height</span> <span style="color:#555">=</span> 480<span style="color:#555">;</span> <span style="color:#09f;font-style:italic">// 追加
</span><span style="color:#09f;font-style:italic"></span>		<span style="color:#069;font-weight:bold">new</span> LwjglApplication<span style="color:#555">(</span><span style="color:#069;font-weight:bold">new</span> LibGdxSample<span style="color:#555">(),</span> config<span style="color:#555">);</span>
	<span style="color:#555">}</span>
<span style="color:#555">}</span></code></pre></div>
<p>実行結果です。</p>

<p><a href="/img/libgdx-beginner/2/018.png" title="/img/libgdx-beginner/2/018.png">/img/libgdx-beginner/2/018.png</a></p>

<p>画面サイズと論理サイズが一致したので赤い帯がなくなりましたね!</p>

<h1 id="タッチ処理">タッチ処理</h1>

<p>いよいよ最後のお題です。私も疲れてきました^^。</p>

<p>前回は、キーボード入力の処理方法は学んだものの
スマホ特有の処理、タッチ操作の処理方法は先送りにしていました。</p>

<p>指でタッチしているかどうかを検知するには、 <code>Gdx.input.isTouched</code> メソッドを使用します。</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">isTouched</span><span style="color:#555">(</span>0<span style="color:#555">))</span> <span style="color:#555">{</span>
    <span style="color:#555">:</span>
  <span style="color:#09f;font-style:italic">// なにかの処理
</span><span style="color:#09f;font-style:italic"></span>    <span style="color:#555">:</span>
<span style="color:#555">}</span></code></pre></div>
<p>このメソッドの引数には番号が必要ですが、これはタッチした指の番号です。
最初にタッチした指の番号は0, 2番目にタッチした座標の番号は1という具合です。</p>

<p>タッチの座標を得るには、 <code>Gdx.input.getX</code> , <code>Gdx.input.getY</code> メソッドを使用します。</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#078;font-weight:bold">float</span> x0 <span style="color:#555">=</span> Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">getX</span><span style="color:#555">(</span>0<span style="color:#555">);</span>
<span style="color:#078;font-weight:bold">float</span> y0 <span style="color:#555">=</span> Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">getY</span><span style="color:#555">(</span>0<span style="color:#555">);</span></code></pre></div>
<p>番号は先程の説明と同じ意味です。</p>

<p>ただしこの座標、注意が必要で、得られる座標は、画面左上を原点とします。</p>

<p>x座標は左から右、Y座標は上から下に伸びます。</p>

<p><a href="/img/libgdx-beginner/2/screen.png" title="/img/libgdx-beginner/2/screen.png">/img/libgdx-beginner/2/screen.png</a></p>

<p>この座標系は一般的にはスクリーン座標系などと呼ばれ、
最終的な絶対座標(物理座標)として使われるものですが、libGDXでは左下を原点とした
座標のためこのままでは使用できません。</p>

<p>ただし私たちは今回カメラを導入しています。なのでカメラの便利メソッドで簡単に変換できます。
こんな感じです。</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  Vector3 touchPos <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> Vector3<span style="color:#555">();</span>
  touchPos<span style="color:#555">.</span><span style="color:#309">set</span><span style="color:#555">(</span>Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">getX</span><span style="color:#555">(),</span> Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">getY</span><span style="color:#555">(),</span> 0<span style="color:#555">);</span>
  camera<span style="color:#555">.</span><span style="color:#309">unproject</span><span style="color:#555">(</span>touchPos<span style="color:#555">);</span> <span style="color:#09f;font-style:italic">// #1
</span><span style="color:#09f;font-style:italic"></span>  targetPos<span style="color:#555">.</span><span style="color:#309">set</span><span style="color:#555">(</span>touchPos<span style="color:#555">.</span><span style="color:#309">x</span><span style="color:#555">,</span> touchPos<span style="color:#555">.</span><span style="color:#309">y</span><span style="color:#555">);</span></code></pre></div>
<p><code>#1</code> で、スクリーン座標で得た左上を原点とした座標をワールドの座標に変換します。</p>

<p>*2013/06/19 追記*
上記説明には、誤りがありました。
カメラだけを使用している場合は、 <code>Camera#unproject()</code> メソッドで良いのですが、
=Viewport= クラスを使用している場合は、 <code>Viewport#unproject()</code> メソッドを使用する必要があります。
従って今回は、 <code>Viewport#unproject()</code> を使用しなければなりません。
説明はこのままにしておきますが、ソースコードの方は訂正してあります。</p>

<p>この処理を <code>if</code> で囲ってあげれば判定処理の出来あがりです。</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">isTouched</span><span style="color:#555">(</span>0<span style="color:#555">))</span> <span style="color:#555">{</span>
  Vector3 touchPos <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> Vector3<span style="color:#555">();</span>
  touchPos<span style="color:#555">.</span><span style="color:#309">set</span><span style="color:#555">(</span>Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">getX</span><span style="color:#555">(),</span> Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">getY</span><span style="color:#555">(),</span> 0<span style="color:#555">);</span>
  camera<span style="color:#555">.</span><span style="color:#309">unproject</span><span style="color:#555">(</span>touchPos<span style="color:#555">);</span> <span style="color:#09f;font-style:italic">// #1
</span><span style="color:#09f;font-style:italic"></span>  targetPos<span style="color:#555">.</span><span style="color:#309">set</span><span style="color:#555">(</span>touchPos<span style="color:#555">.</span><span style="color:#309">x</span><span style="color:#555">,</span> touchPos<span style="color:#555">.</span><span style="color:#309">y</span><span style="color:#555">);</span>
<span style="color:#555">}</span></code></pre></div>
<p><code>Gdx.input.isTouched</code> メソッドは、タッチし続けてれば、毎フレーム「真」になります。</p>

<p>他にタッチを検出するメソッドとして、
 <code>Gdx.input.justTouched</code> メソッドがあります。
このメソッドは、ひとつ前のフレームにタッチしていた場合は、偽になります。
どういうことかというと、押しっぱなしにしてた場合は、
最初の一回しか真にならないということです。</p>

<p>例えば、下記のようなコードで、タッチした時だけ音を鳴らすことができます。</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">justTouched</span><span style="color:#555">())</span> <span style="color:#555">{</span>
    sound<span style="color:#555">.</span><span style="color:#309">play</span><span style="color:#555">();</span>
<span style="color:#555">}</span></code></pre></div>
<p>ちなみにjustTouchedと同等の機能のキーボード版のメソッドはありません。
恐らく、このメソッドの実装には、状態変数の保持が必要になってくるので、
そこをライブラリ側で実装してしまうと無駄が多くなるので、
ユーザー側に任せたのだと思います。</p>

<p>では、上記の説明をもとに、スプライトをタッチした場所へ移動させるコードを追加します。
下記のように修正してみてください。</p>

<p>インポート。</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.math.Vector3</span><span style="color:#555">;</span></code></pre></div>
<p>フィールド。</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  Vector2 targetPos<span style="color:#555">;</span></code></pre></div>
<p><code>render</code> メソッド。キーボード処理の直後に追加します。</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  <span style="color:#99f">@Override</span>
  <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">render</span><span style="color:#555">()</span> <span style="color:#555">{</span>
       <span style="color:#a00;background-color:#faa">：</span>
    <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">isKeyPressed</span><span style="color:#555">(</span>Input<span style="color:#555">.</span><span style="color:#309">Keys</span><span style="color:#555">.</span><span style="color:#309">DOWN</span><span style="color:#555">))</span> <span style="color:#555">{</span>
        pos<span style="color:#555">.</span><span style="color:#309">y</span> <span style="color:#555">-=</span> 1<span style="color:#555">;</span>
        camera<span style="color:#555">.</span><span style="color:#309">position</span><span style="color:#555">.</span><span style="color:#309">y</span> <span style="color:#555">-=</span> 2<span style="color:#555">;</span>
    <span style="color:#555">}</span>
       <span style="color:#555">:</span>
    <span style="color:#09f;font-style:italic">// ↓追加
</span><span style="color:#09f;font-style:italic"></span>    <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">justTouched</span><span style="color:#555">())</span> <span style="color:#555">{</span>
         sound<span style="color:#555">.</span><span style="color:#309">play</span><span style="color:#555">();</span>
    <span style="color:#555">}</span>
    <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">isTouched</span><span style="color:#555">(</span>0<span style="color:#555">))</span> <span style="color:#555">{</span>
      Vector3 touchPos <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> Vector3<span style="color:#555">();</span>
      touchPos<span style="color:#555">.</span><span style="color:#309">set</span><span style="color:#555">(</span>Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">getX</span><span style="color:#555">(),</span> Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">getY</span><span style="color:#555">(),</span> 0<span style="color:#555">);</span>
      camera<span style="color:#555">.</span><span style="color:#309">unproject</span><span style="color:#555">(</span>touchPos<span style="color:#555">);</span>
      targetPos<span style="color:#555">.</span><span style="color:#309">set</span><span style="color:#555">(</span>touchPos<span style="color:#555">.</span><span style="color:#309">x</span><span style="color:#555">,</span> touchPos<span style="color:#555">.</span><span style="color:#309">y</span><span style="color:#555">);</span>
    <span style="color:#555">}</span>
    <span style="color:#09f;font-style:italic">// ↑追加
</span><span style="color:#09f;font-style:italic"></span>    String info <span style="color:#555">=</span> String<span style="color:#555">.</span><span style="color:#309">format</span><span style="color:#555">(</span><span style="color:#c30">&#34;cam pos(%f,%f)&#34;</span><span style="color:#555">,</span> camera<span style="color:#555">.</span><span style="color:#309">position</span><span style="color:#555">.</span><span style="color:#309">x</span><span style="color:#555">,</span> camera<span style="color:#555">.</span><span style="color:#309">position</span><span style="color:#555">.</span><span style="color:#309">y</span><span style="color:#555">);</span>
    <span style="color:#09f;font-style:italic">// ↓追加
</span><span style="color:#09f;font-style:italic"></span>    pos<span style="color:#555">.</span><span style="color:#309">lerp</span><span style="color:#555">(</span>targetPos<span style="color:#555">,</span> 0<span style="color:#555">.</span><span style="color:#309">2f</span><span style="color:#555">);</span>
    sprite<span style="color:#555">.</span><span style="color:#309">setPosition</span><span style="color:#555">(</span>pos<span style="color:#555">.</span><span style="color:#309">x</span><span style="color:#555">,</span> pos<span style="color:#555">.</span><span style="color:#309">y</span><span style="color:#555">);</span>
    <span style="color:#09f;font-style:italic">// ↑追加
</span><span style="color:#09f;font-style:italic"></span>       <span style="color:#a00;background-color:#faa">：</span>
  <span style="color:#555">}</span></code></pre></div>
<p><code>render</code> メソッド内で実行している <code>pos.lerp</code> メソッドは、第一引数の座標
へ値を少しずつ近づけていく処理を実施します。「最初早くて後おそく」って感じの動きです。</p>

<p>では、実行してみます。</p>

<p><a href="/img/libgdx-beginner/2/019.png" title="/img/libgdx-beginner/2/019.png">/img/libgdx-beginner/2/019.png</a></p>

<p>これまでのコードを忠実に入力していれば、音をビヨーンとならしながら移動します。</p>

<p>以上で今回の解説は終了です。お疲れさまでした。</p>

<h1 id="ソース">ソース</h1>

<p>最後に今回のソースコードを掲載しておきます。</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#069;font-weight:bold">package</span> <span style="color:#0cf;font-weight:bold">com.zarudama.libgdxtest</span><span style="color:#555">;</span>

<span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.ApplicationAdapter</span><span style="color:#555">;</span>
<span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.Gdx</span><span style="color:#555">;</span>
<span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.Input</span><span style="color:#555">;</span>
<span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.audio.Music</span><span style="color:#555">;</span>
<span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.audio.Sound</span><span style="color:#555">;</span>
<span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.graphics.GL20</span><span style="color:#555">;</span>
<span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.graphics.OrthographicCamera</span><span style="color:#555">;</span>
<span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.graphics.PerspectiveCamera</span><span style="color:#555">;</span>
<span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.graphics.Camera</span><span style="color:#555">;</span>
<span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.graphics.Texture</span><span style="color:#555">;</span>
<span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.graphics.g2d.BitmapFont</span><span style="color:#555">;</span>
<span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.graphics.g2d.Sprite</span><span style="color:#555">;</span>
<span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.graphics.g2d.SpriteBatch</span><span style="color:#555">;</span>
<span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.math.Vector2</span><span style="color:#555">;</span>
<span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.math.Vector3</span><span style="color:#555">;</span>
<span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.utils.viewport.FitViewport</span><span style="color:#555">;</span>
<span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.utils.viewport.FillViewport</span><span style="color:#555">;</span>
<span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.utils.viewport.StretchViewport</span><span style="color:#555">;</span>
<span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.utils.viewport.ScreenViewport</span><span style="color:#555">;</span>
<span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.utils.viewport.ExtendViewport</span><span style="color:#555">;</span>
<span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.utils.viewport.Viewport</span><span style="color:#555">;</span>
<span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.badlogic.gdx.graphics.glutils.ShapeRenderer</span><span style="color:#555">;</span>

<span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">class</span> <span style="color:#0a8;font-weight:bold">LibGdxSample</span> <span style="color:#069;font-weight:bold">extends</span> ApplicationAdapter <span style="color:#555">{</span>
    SpriteBatch batch<span style="color:#555">;</span>
    BitmapFont font<span style="color:#555">;</span>
    Texture img<span style="color:#555">;</span>
    Sprite sprite<span style="color:#555">;</span>
    Sprite sprite2<span style="color:#555">;</span>
    Vector2 pos<span style="color:#555">;</span>
    Sound sound<span style="color:#555">;</span>
    Music music<span style="color:#555">;</span>
    <span style="color:#078;font-weight:bold">float</span> angle<span style="color:#555">;</span>
    OrthographicCamera camera<span style="color:#555">;</span>
    Viewport viewport<span style="color:#555">;</span>

    Texture bgImg<span style="color:#555">;</span>
    Sprite bg<span style="color:#555">;</span>
    ShapeRenderer shapeRenderer<span style="color:#555">;</span>

    OrthographicCamera uiCamera<span style="color:#555">;</span>

    Vector2 targetPos<span style="color:#555">;</span>

    <span style="color:#99f">@Override</span>
    <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">create</span> <span style="color:#555">()</span> <span style="color:#555">{</span>
        batch <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> SpriteBatch<span style="color:#555">();</span>
        font <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> BitmapFont<span style="color:#555">();</span>
        img <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> Texture<span style="color:#555">(</span><span style="color:#c30">&#34;badlogic.jpg&#34;</span><span style="color:#555">);</span>
        sprite <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> Sprite<span style="color:#555">(</span>img<span style="color:#555">);</span>
        sprite2 <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> Sprite<span style="color:#555">(</span>img<span style="color:#555">);</span>
        pos <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> Vector2<span style="color:#555">();</span>
        sound <span style="color:#555">=</span> Gdx<span style="color:#555">.</span><span style="color:#309">audio</span><span style="color:#555">.</span><span style="color:#309">newSound</span><span style="color:#555">(</span>Gdx<span style="color:#555">.</span><span style="color:#309">files</span><span style="color:#555">.</span><span style="color:#309">internal</span><span style="color:#555">(</span><span style="color:#c30">&#34;jump.wav&#34;</span><span style="color:#555">));</span>
        music <span style="color:#555">=</span> Gdx<span style="color:#555">.</span><span style="color:#309">audio</span><span style="color:#555">.</span><span style="color:#309">newMusic</span><span style="color:#555">(</span>Gdx<span style="color:#555">.</span><span style="color:#309">files</span><span style="color:#555">.</span><span style="color:#309">internal</span><span style="color:#555">(</span><span style="color:#c30">&#34;mixdown.mp3&#34;</span><span style="color:#555">));</span>
        music<span style="color:#555">.</span><span style="color:#309">setLooping</span><span style="color:#555">(</span><span style="color:#069;font-weight:bold">true</span><span style="color:#555">);</span>
        music<span style="color:#555">.</span><span style="color:#309">setVolume</span><span style="color:#555">(</span>0<span style="color:#555">.</span><span style="color:#309">5f</span><span style="color:#555">);</span>
        music<span style="color:#555">.</span><span style="color:#309">play</span><span style="color:#555">();</span>

        bgImg <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> Texture<span style="color:#555">(</span><span style="color:#c30">&#34;bg.png&#34;</span><span style="color:#555">);</span>
        bg <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> Sprite<span style="color:#555">(</span>bgImg<span style="color:#555">);</span>
        bg<span style="color:#555">.</span><span style="color:#309">setScale</span><span style="color:#555">(</span>2<span style="color:#555">.</span><span style="color:#309">0f</span><span style="color:#555">,</span> 2<span style="color:#555">.</span><span style="color:#309">0f</span><span style="color:#555">);</span>
        bg<span style="color:#555">.</span><span style="color:#309">setPosition</span><span style="color:#555">(-</span>400<span style="color:#555">,</span> <span style="color:#555">-</span>240<span style="color:#555">);</span>

        camera <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> OrthographicCamera<span style="color:#555">(</span>800<span style="color:#555">,</span>480<span style="color:#555">);</span>
        camera<span style="color:#555">.</span><span style="color:#309">setToOrtho</span><span style="color:#555">(</span><span style="color:#069;font-weight:bold">false</span><span style="color:#555">,</span> 800<span style="color:#555">,</span> 480<span style="color:#555">);</span>
        viewport <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> FitViewport<span style="color:#555">(</span>800<span style="color:#555">,</span> 480<span style="color:#555">,</span> camera<span style="color:#555">);</span>

        uiCamera <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> OrthographicCamera<span style="color:#555">();</span>
        uiCamera<span style="color:#555">.</span><span style="color:#309">setToOrtho</span><span style="color:#555">(</span><span style="color:#069;font-weight:bold">false</span><span style="color:#555">,</span> 800<span style="color:#555">,</span> 480<span style="color:#555">);</span>

        shapeRenderer <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> ShapeRenderer<span style="color:#555">();</span>

        targetPos <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> Vector2<span style="color:#555">();</span>
    <span style="color:#555">}</span>

    <span style="color:#99f">@Override</span>
    <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">resize</span><span style="color:#555">(</span><span style="color:#078;font-weight:bold">int</span> width<span style="color:#555">,</span> <span style="color:#078;font-weight:bold">int</span> height<span style="color:#555">)</span> <span style="color:#555">{</span>
        viewport<span style="color:#555">.</span><span style="color:#309">update</span><span style="color:#555">(</span>width<span style="color:#555">,</span> height<span style="color:#555">);</span>
    <span style="color:#555">}</span>

    <span style="color:#99f">@Override</span>
    <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">render</span><span style="color:#555">()</span> <span style="color:#555">{</span>
        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">isKeyPressed</span><span style="color:#555">(</span>Input<span style="color:#555">.</span><span style="color:#309">Keys</span><span style="color:#555">.</span><span style="color:#309">LEFT</span><span style="color:#555">))</span> <span style="color:#555">{</span>
            camera<span style="color:#555">.</span><span style="color:#309">position</span><span style="color:#555">.</span><span style="color:#309">x</span> <span style="color:#555">-=</span> 2<span style="color:#555">;</span>
        <span style="color:#555">}</span>
        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">isKeyPressed</span><span style="color:#555">(</span>Input<span style="color:#555">.</span><span style="color:#309">Keys</span><span style="color:#555">.</span><span style="color:#309">RIGHT</span><span style="color:#555">))</span> <span style="color:#555">{</span>
            camera<span style="color:#555">.</span><span style="color:#309">position</span><span style="color:#555">.</span><span style="color:#309">x</span> <span style="color:#555">+=</span> 2<span style="color:#555">;</span>
        <span style="color:#555">}</span>
        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">isKeyPressed</span><span style="color:#555">(</span>Input<span style="color:#555">.</span><span style="color:#309">Keys</span><span style="color:#555">.</span><span style="color:#309">UP</span><span style="color:#555">))</span> <span style="color:#555">{</span>
            camera<span style="color:#555">.</span><span style="color:#309">position</span><span style="color:#555">.</span><span style="color:#309">y</span> <span style="color:#555">+=</span> 2<span style="color:#555">;</span>
        <span style="color:#555">}</span>
        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">isKeyPressed</span><span style="color:#555">(</span>Input<span style="color:#555">.</span><span style="color:#309">Keys</span><span style="color:#555">.</span><span style="color:#309">DOWN</span><span style="color:#555">))</span> <span style="color:#555">{</span>
            camera<span style="color:#555">.</span><span style="color:#309">position</span><span style="color:#555">.</span><span style="color:#309">y</span> <span style="color:#555">-=</span> 2<span style="color:#555">;</span>
        <span style="color:#555">}</span>
        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">justTouched</span><span style="color:#555">())</span> <span style="color:#555">{</span>
            sound<span style="color:#555">.</span><span style="color:#309">play</span><span style="color:#555">();</span>
        <span style="color:#555">}</span>
        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">isTouched</span><span style="color:#555">(</span>0<span style="color:#555">))</span> <span style="color:#555">{</span>
            Vector3 touchPos <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> Vector3<span style="color:#555">();</span>
            touchPos<span style="color:#555">.</span><span style="color:#309">set</span><span style="color:#555">(</span>Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">getX</span><span style="color:#555">(),</span> Gdx<span style="color:#555">.</span><span style="color:#309">input</span><span style="color:#555">.</span><span style="color:#309">getY</span><span style="color:#555">(),</span> 0<span style="color:#555">);</span>
            viewport<span style="color:#555">.</span><span style="color:#309">unproject</span><span style="color:#555">(</span>touchPos<span style="color:#555">);</span>
            targetPos<span style="color:#555">.</span><span style="color:#309">set</span><span style="color:#555">(</span>touchPos<span style="color:#555">.</span><span style="color:#309">x</span><span style="color:#555">,</span> touchPos<span style="color:#555">.</span><span style="color:#309">y</span><span style="color:#555">);</span>
        <span style="color:#555">}</span>
        String info <span style="color:#555">=</span> String<span style="color:#555">.</span><span style="color:#309">format</span><span style="color:#555">(</span><span style="color:#c30">&#34;cam pos(%f,%f)&#34;</span><span style="color:#555">,</span> camera<span style="color:#555">.</span><span style="color:#309">position</span><span style="color:#555">.</span><span style="color:#309">x</span><span style="color:#555">,</span> camera<span style="color:#555">.</span><span style="color:#309">position</span><span style="color:#555">.</span><span style="color:#309">y</span><span style="color:#555">);</span>

        pos<span style="color:#555">.</span><span style="color:#309">lerp</span><span style="color:#555">(</span>targetPos<span style="color:#555">,</span> 0<span style="color:#555">.</span><span style="color:#309">2f</span><span style="color:#555">);</span>
        sprite<span style="color:#555">.</span><span style="color:#309">setPosition</span><span style="color:#555">(</span>pos<span style="color:#555">.</span><span style="color:#309">x</span><span style="color:#555">,</span> pos<span style="color:#555">.</span><span style="color:#309">y</span><span style="color:#555">);</span>
        sprite<span style="color:#555">.</span><span style="color:#309">setScale</span><span style="color:#555">((</span><span style="color:#078;font-weight:bold">float</span><span style="color:#555">)</span> Math<span style="color:#555">.</span><span style="color:#309">sin</span><span style="color:#555">(</span>angle<span style="color:#555">));</span>
        angle <span style="color:#555">+=</span> 0<span style="color:#555">.</span><span style="color:#309">04</span><span style="color:#555">;</span>

        sprite2<span style="color:#555">.</span><span style="color:#309">setRotation</span><span style="color:#555">(</span>angle<span style="color:#555">);</span>
        sprite2<span style="color:#555">.</span><span style="color:#309">setPosition</span><span style="color:#555">(</span>200<span style="color:#555">,</span> 300<span style="color:#555">);</span>
        sprite2<span style="color:#555">.</span><span style="color:#309">setRotation</span><span style="color:#555">(</span>angle<span style="color:#555">);</span>

        Gdx<span style="color:#555">.</span><span style="color:#309">gl</span><span style="color:#555">.</span><span style="color:#309">glClearColor</span><span style="color:#555">(</span>1<span style="color:#555">,</span> 0<span style="color:#555">,</span> 0<span style="color:#555">,</span> 1<span style="color:#555">);</span>
        Gdx<span style="color:#555">.</span><span style="color:#309">gl</span><span style="color:#555">.</span><span style="color:#309">glClear</span><span style="color:#555">(</span>GL20<span style="color:#555">.</span><span style="color:#309">GL_COLOR_BUFFER_BIT</span><span style="color:#555">);</span>
        camera<span style="color:#555">.</span><span style="color:#309">update</span><span style="color:#555">();</span> <span style="color:#09f;font-style:italic">// ワールドからスクリーンまでのマトリックスを生成する。
</span><span style="color:#09f;font-style:italic"></span>        batch<span style="color:#555">.</span><span style="color:#309">setProjectionMatrix</span><span style="color:#555">(</span>camera<span style="color:#555">.</span><span style="color:#309">combined</span><span style="color:#555">);</span>
        batch<span style="color:#555">.</span><span style="color:#309">begin</span><span style="color:#555">();</span>
        bg<span style="color:#555">.</span><span style="color:#309">draw</span><span style="color:#555">(</span>batch<span style="color:#555">);</span>
        sprite<span style="color:#555">.</span><span style="color:#309">draw</span><span style="color:#555">(</span>batch<span style="color:#555">);</span>
        sprite2<span style="color:#555">.</span><span style="color:#309">draw</span><span style="color:#555">(</span>batch<span style="color:#555">);</span>
        batch<span style="color:#555">.</span><span style="color:#309">end</span><span style="color:#555">();</span>

        <span style="color:#09f;font-style:italic">// ワールド座標軸を描画する。
</span><span style="color:#09f;font-style:italic"></span>        shapeRenderer<span style="color:#555">.</span><span style="color:#309">setProjectionMatrix</span><span style="color:#555">(</span>camera<span style="color:#555">.</span><span style="color:#309">combined</span><span style="color:#555">);</span>
        shapeRenderer<span style="color:#555">.</span><span style="color:#309">begin</span><span style="color:#555">(</span>ShapeRenderer<span style="color:#555">.</span><span style="color:#309">ShapeType</span><span style="color:#555">.</span><span style="color:#309">Line</span><span style="color:#555">);</span>
        shapeRenderer<span style="color:#555">.</span><span style="color:#309">setColor</span><span style="color:#555">(</span>1<span style="color:#555">,</span> 0<span style="color:#555">,</span> 0<span style="color:#555">,</span> 1<span style="color:#555">);</span>
        shapeRenderer<span style="color:#555">.</span><span style="color:#309">line</span><span style="color:#555">(-</span>1024<span style="color:#555">,</span> 0<span style="color:#555">,</span> 1024<span style="color:#555">,</span> 0<span style="color:#555">);</span>
        shapeRenderer<span style="color:#555">.</span><span style="color:#309">setColor</span><span style="color:#555">(</span>0<span style="color:#555">,</span> 1<span style="color:#555">,</span> 0<span style="color:#555">,</span> 1<span style="color:#555">);</span>
        shapeRenderer<span style="color:#555">.</span><span style="color:#309">line</span><span style="color:#555">(</span>0<span style="color:#555">,</span> <span style="color:#555">-</span>1024<span style="color:#555">,</span> 0<span style="color:#555">,</span> 1024<span style="color:#555">);</span>
        shapeRenderer<span style="color:#555">.</span><span style="color:#309">end</span><span style="color:#555">();</span>

        uiCamera<span style="color:#555">.</span><span style="color:#309">update</span><span style="color:#555">();</span> <span style="color:#09f;font-style:italic">// uiCameraを動かさないのであれば、必要ない。
</span><span style="color:#09f;font-style:italic"></span>        batch<span style="color:#555">.</span><span style="color:#309">setProjectionMatrix</span><span style="color:#555">(</span>uiCamera<span style="color:#555">.</span><span style="color:#309">combined</span><span style="color:#555">);</span>
        batch<span style="color:#555">.</span><span style="color:#309">begin</span><span style="color:#555">();</span>
        font<span style="color:#555">.</span><span style="color:#309">draw</span><span style="color:#555">(</span>batch<span style="color:#555">,</span> info<span style="color:#555">,</span> 0<span style="color:#555">,</span> 20<span style="color:#555">);</span>
        font<span style="color:#555">.</span><span style="color:#309">draw</span><span style="color:#555">(</span>batch<span style="color:#555">,</span> <span style="color:#c30">&#34;Hello libGDX&#34;</span><span style="color:#555">,</span> 200<span style="color:#555">,</span> 400<span style="color:#555">);</span>
        batch<span style="color:#555">.</span><span style="color:#309">end</span><span style="color:#555">();</span>
    <span style="color:#555">}</span>

    <span style="color:#99f">@Override</span>
    <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">dispose</span><span style="color:#555">()</span> <span style="color:#555">{</span>
        sound<span style="color:#555">.</span><span style="color:#309">dispose</span><span style="color:#555">();</span>
        music<span style="color:#555">.</span><span style="color:#309">dispose</span><span style="color:#555">();</span>
        batch<span style="color:#555">.</span><span style="color:#309">dispose</span><span style="color:#555">();</span>
        font<span style="color:#555">.</span><span style="color:#309">dispose</span><span style="color:#555">();</span>
        img<span style="color:#555">.</span><span style="color:#309">dispose</span><span style="color:#555">();</span>
        bgImg<span style="color:#555">.</span><span style="color:#309">dispose</span><span style="color:#555">();</span>
        shapeRenderer<span style="color:#555">.</span><span style="color:#309">dispose</span><span style="color:#555">();</span>
    <span style="color:#555">}</span>
<span style="color:#555">}</span></code></pre></div>
<h1 id="おわりに">おわりに</h1>

<ul>
面倒だけど重要な説明が終りました。
これで、端末の画面サイズを気にせずプログラミングできるようになりました。
<a href="/posts/libgdx-beginner3/" title="次回">次回</a> は、そろそろゲームっぽいものをつくろうかなと思います。
予定している内容は、
<li>アニメーション処理</li>
<li>画面遷移</li>
<li>2DScene</li>
などです。
</ul>

<h1 id="参考url">参考URL</h1>

<h1 id="参考書籍">参考書籍</h1>

<ul>
ビューポートについては下記にも詳しい内容があります。合せて読めば理解も深まると思います。
<li>http://qiita.com/fslasht/items/13dbf31277ad43e50b85</li>
<li>http://qiita.com/fslasht/items/c0830eaf05b7a91b8e85</li>
「<a href="https://amzn.to/3S70Tbm" title="Androidゲームプログラミング A to Z">Androidゲームプログラミング A to Z</a> 」
</ul>

<h1 id="変更履歴">変更履歴</h1>

<ul>
<a href="/img/amazon_android_gameprogiraming_a_to_z.jpg" title="/img/amazon_android_gameprogiraming_a_to_z.jpg">/img/amazon_android_gameprogiraming_a_to_z.jpg</a>
<li>2014/06/19 タッチ座標の取得方法に問題があったのを訂正した。</li>
</ul>

    
</div>
<div class="pager pure-u-1">
  
  <div class="pager-new">
    <a href="https://zarudama.github.io/posts/libgdx-beginner3/"><span class="date">&laquo;&nbsp;new&nbsp;&nbsp;</span>libGDX入門 その03 ログ出力とアニメーションとバーチャルパッド</a>
  </div>
  
  
  <div class="pager-old">
  <a href="https://zarudama.github.io/posts/cask/">Caskの導入と設定ファイルの棚卸し<span class="date">&nbsp;&nbsp;old&nbsp;&raquo;</span></a>
  </div>
  
</div>

        </div>
      </article><div class="footer pure-u-1">
  <div class="container">
    <div class="text">
      <p>Copyright &copy; ざる魂</p>
      <p>Powered by <a href="https://gohugo.io/">HUGO</a></p>
    </div>
    <div class="added">
      <div class="menu">
        <ul>
          <li><a href="https://twitter.com/zarudama_games"><i class="fa fa-twitter-square"></i><span>Twitter</span></a></li>
        </ul>
      </div>
    </div>
  </div>
</div>
</body>
</html>
